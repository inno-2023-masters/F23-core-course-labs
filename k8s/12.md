# Lab 12. Configmaps
## Task 1
Check README for python app

## Task 2
Let's save the following config to configmap:
```json
{
  "databaseUrl": "http://database:5432",
  "retryStrategy": {
    "numberOfRetries": 5,
    "timeoutSteps": [
      10,
      50,
      100,
      500
    ]
  }
}
```


Configmap manifest keeps in `configmap.yaml` file
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-python-config-map
data:
  config.json: |-
{{ .Files.Get "files/config.json" | indent 4}}
```

```
$ kubectl describe configmaps app-python-config-map
Name:         app-python-config-map
Namespace:    default
Labels:       app.kubernetes.io/managed-by=Helm
Annotations:  meta.helm.sh/release-name: app-python
              meta.helm.sh/release-namespace: default

Data
====
config.json:
----
{
  "databaseUrl": "http://database:5432",
  "retryStrategy": {
    "numberOfRetries": 5,
    "timeoutSteps": [
      10,
      50,
      100,
      500
    ]
  }
}

BinaryData
====

Events:  <none>
```

```
$ kubectl get po
NAME                                    READY   STATUS    RESTARTS      AGE
app-python-d8f48f5fb-mkpb7              2/2     Running   0             2m45s
app-python-d8f48f5fb-n47hc              2/2     Running   0             2m45s
app-python-d8f48f5fb-s2m8q              2/2     Running   0             2m45s
vault-0                                 1/1     Running   2 (65m ago)   8d
vault-agent-injector-5cd8b87c6c-rctsv   1/1     Running   2 (65m ago)   8d
```

```
$ kubectl exec app-python-d8f48f5fb-mkpb7 -- cat /app/configs/config.json
Defaulted container "app-python" out of: app-python, vault-agent, vault-agent-init (init)
{
  "databaseUrl": "http://database:5432",
  "retryStrategy": {
    "numberOfRetries": 5,
    "timeoutSteps": [
      10,
      50,
      100,
      500
    ]
  }
}
```


## Bonus task
### 1
Check README.md for Kotlin app

```
$ docker volume ls | grep "base"
local     monitoring_base_converter_app_data
```

### 2
```
$ kubectl get pods
NAME                                    READY   STATUS    RESTARTS      AGE
app-python-68cbd7c77f-d5p7j             2/2     Running   0             17m
app-python-68cbd7c77f-g8znj             2/2     Running   0             17m
app-python-68cbd7c77f-l48fm             2/2     Running   0             17m
vault-0                                 1/1     Running   3 (22m ago)   8d
vault-agent-injector-5cd8b87c6c-rctsv   1/1     Running   3 (22m ago)   8d
```

```
$ kubectl exec -it app-python-68cbd7c77f-d5p7j /bin/bash
kubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl exec [POD] -- [COMMAND] instead.
Defaulted container "app-python" out of: app-python, vault-agent, vault-agent-init (init)
app@app-python-68cbd7c77f-d5p7j:/app$ env
config.json={
  "databaseUrl": "http://database:5432",
  "retryStrategy": {
    "numberOfRetries": 5,
    "timeoutSteps": [
      10,
      50,
      100,
      500
    ]
  }
}
IS_RETRY_STRATEGY_ON=true
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_SERVICE_PORT=443
VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
HOSTNAME=app-python-68cbd7c77f-d5p7j
PYTHON_VERSION=3.11.6
VAULT_PORT_8201_TCP_PROTO=tcp
VAULT_PORT_8200_TCP_ADDR=10.109.25.80
EXTERNAL_SERVICE_URL=https://url:8083
APP_PYTHON_SERVICE_PORT_HTTP=80
VAULT_SERVICE_PORT=8200
VAULT_PORT_8201_TCP_PORT=8201
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
PWD=/app
VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.103.112.208:443
APP_PYTHON_PORT_80_TCP_ADDR=10.104.22.14
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
PYTHON_SETUPTOOLS_VERSION=65.5.1
VAULT_PORT_8200_TCP_PROTO=tcp
HOME=/nonexistent
LANG=C.UTF-8
VAULT_PORT_8200_TCP_PORT=8200
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
VAULT_PORT_8201_TCP=tcp://10.109.25.80:8201
GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D
APP_PYTHON_PORT=tcp://10.104.22.14:80
VAULT_SERVICE_PORT_HTTP=8200
APP_PYTHON_PORT_80_TCP=tcp://10.104.22.14:80
JWT_TOKEN=SECRET_TOKEN
TERM=xterm
APP_PYTHON_SERVICE_PORT=80
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.103.112.208
APP_PYTHON_SERVICE_HOST=10.104.22.14
SHLVL=1
KUBERNETES_PORT_443_TCP_PROTO=tcp
PYTHON_PIP_VERSION=23.2.1
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
VAULT_PORT_8201_TCP_ADDR=10.109.25.80
PYTHON_GET_PIP_SHA256=22b849a10f86f5ddf7ce148ca2a31214504ee6c83ef626840fde6e5dcd809d11
VAULT_PORT_8200_TCP=tcp://10.109.25.80:8200
APP_PYTHON_PORT_80_TCP_PROTO=tcp
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.103.112.208:443
KUBERNETES_SERVICE_HOST=10.96.0.1
VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.103.112.208
VAULT_SERVICE_HOST=10.109.25.80
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP_PORT=443
PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/c6add47b0abf67511cdfb4734771cbab403af062/public/get-pip.py
PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
APP_PYTHON_PORT_80_TCP_PORT=80
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
VAULT_PORT=tcp://10.109.25.80:8200
_=/usr/bin/env
```