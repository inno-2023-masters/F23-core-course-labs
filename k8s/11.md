
### Create secrets

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl create secret generic db-user-pass     --from-literal=username=admin     --from-literal=password='12345678'
secret/db-user-pass created
```

### Verify secrets

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get secrets
NAME                           TYPE                 DATA   AGE
db-user-pass                   Opaque               2      48s
sh.helm.release.v1.python.v1   helm.sh/release.v1   1      3d
```

### Decode secrets

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get secret db-user-pass -o jsonpath='{.data.password}' | base64 --decode
12345678
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get secret db-user-pass -o jsonpath='{.data.username}' | base64 --decode
admin
```

## Manage secrets with helm

### Configuration

* Install plugin

```shell
helm plugin install https://github.com/zendesk/helm-secrets
```

* Generate gpg key

```shell
gpg --gen-key
```

* Edit secrets

```shell
EDITOR='nano' sops -p PUB_KEY secrets.yaml
```

* View secrets

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s/python-app/templates$ helm secrets view secrets.yaml 
password: abc12345678
```

### Use Helm to manage your secrets

* Create a secrets.yaml file in the templates folder

* Define a secret object within this YAML file

* Add an env field to the Deployment. The path to update is: spec.template.spec.containers.env

* Install helm with secret

```shell
helm secrets install python-app ./python-app/ -n default -f ./secrets.yaml
```

* Verify secret inside pod

```shell
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl get po
NAME                          READY   STATUS    RESTARTS   AGE
python-app-6bf47dfd97-52w6x   1/1     Running   0          33s
python-app-6bf47dfd97-dnkh9   1/1     Running   0          33s
python-app-6bf47dfd97-sp2hp   1/1     Running   0          33s
quiner@quiner-MaiBook-X-series:~/innopolis/dev-ops-course-labs/k8s$ kubectl exec python-app-6bf47dfd97-52w6x -- printenv | grep MY_PASS
MY_PASSWORD=abc12345678
```