# Task 1

Creating secret:

❯ `kubectl create secret generic doe-user-pass --from-literal=username=doe --from-literal=password='S!B\*d$zDsb='`

```bash
secret/doe-user-pass created
```

❯ `kubectl describe secret doe-user-pass`

```bash
Name:         doe-user-pass
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  12 bytes
username:  3 bytes
```

Decoding:

❯ `kubectl get  secret doe-user-pass -o jsonpath='{.data.username}' | base64 --decode`

```bash
doe
```

❯ `kubectl get  secret doe-user-pass -o jsonpath='{.data.password}' | base64 --decode`

```bash
S!B\*d$zDsb=
```

Generating a key and encrypting a secrets file with it:

```bash
gpg --gen-key

sops -p 11CCA78A6BFA315E4AD1B4D9B666EA32C9E4AD52 secrets.yaml
```

It's possible to decrypt the secret using PGP key:

❯ `helm secrets decrypt secrets.yaml`

```bash
doesecret: doe_secret123
```

Installing the helm chart and putting the secret inside:

❯ `helm secrets install doe-app ./doe-app/ -n default -f ./secrets.yaml`

```bash
[helm-secrets] Decrypt: ./secrets.yaml
NAME: doe-app
LAST DEPLOYED: Tue Nov 14 03:19:38 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=doe-app,app.kubernetes.io/instance=doe-app" -o jsonpath="{.items[0].metadata.name}")
export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
echo "Visit http://127.0.0.1:8080 to use your application"
kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
```

❯ `kubectl get po`

```bash
NAME                       READY   STATUS    RESTARTS   AGE
doe-app-6979b5dccf-fpvsh   1/1     Running   0          2m5s
```

❯ `kubectl exec doe-app-6979b5dccf-lmflj -- printenv | grep DOE_SECRET`

```bash
DOE_SECRET=doesecret123
```

Proof ig:
![Alt text](image.png)
