## Creating pods with replicaset

I updated my deployment template to statefulset template and condifured it with some values from `values.yaml`.

Installing chart:
`helm install app-python-chart app-python/`

Monitoring chart installing process:
`kubectl get pods -w -l app=app-python`

```
web-app-statefulset-0   0/1     Pending       0          0s
web-app-statefulset-0   0/1     Pending       0          0s
web-app-statefulset-0   0/1     Pending       0          1s
web-app-statefulset-0   0/1     ContainerCreating   0          1s
web-app-statefulset-0   1/1     Running             0          4s
web-app-statefulset-1   0/1     Pending             0          0s
web-app-statefulset-1   0/1     Pending             0          0s
web-app-statefulset-1   0/1     Pending             0          1s
web-app-statefulset-1   0/1     ContainerCreating   0          1s
web-app-statefulset-1   1/1     Running             0          4s
```

`kubectl get po,sts,svc,pvc`

```
NAME                                        READY   STATUS    RESTARTS       AGE
pod/vault-0                                 1/1     Running   6 (33m ago)    15d
pod/vault-agent-injector-5cd8b87c6c-bflh9   1/1     Running   6 (12h ago)    15d
pod/web-548f6458b5-2vbr4                    1/1     Running   11 (12h ago)   28d
pod/web-app-statefulset-0                   1/1     Running   0              18m
pod/web-app-statefulset-1                   1/1     Running   0              18m

NAME                                   READY   AGE
statefulset.apps/vault                 1/1     15d
statefulset.apps/web-app-statefulset   2/2     18m

NAME                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
service/app-python-chart           ClusterIP   10.106.43.170   <none>        8000/TCP            18m
service/kubernetes                 ClusterIP   10.96.0.1       <none>        443/TCP             30d
service/vault                      ClusterIP   10.104.121.35   <none>        8200/TCP,8201/TCP   15d
service/vault-agent-injector-svc   ClusterIP   10.96.237.74    <none>        443/TCP             15d
service/vault-internal             ClusterIP   None            <none>        8200/TCP,8201/TCP   15d

NAME                                                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/config-volume-app-python-chart-0      Bound    pvc-80464dd8-cb25-4089-89e9-61459b5ad1bb   1Gi        RWO            standard       31m
persistentvolumeclaim/config-volume-app-python-chart-1      Bound    pvc-9481bc6e-7b56-4720-82bd-3f1e8fe84c33   1Gi        RWO            standard       31m
persistentvolumeclaim/config-volume-statefulset-0           Bound    pvc-e8861d9c-ea17-4c4e-917d-3af35cb932ea   1Gi        RWO            standard       28m
persistentvolumeclaim/config-volume-statefulset-1           Bound    pvc-861c3d9e-d7b4-4da6-b3ec-ecbb0dbc4321   1Gi        RWO            standard       27m
persistentvolumeclaim/config-volume-web-app-statefulset-0   Bound    pvc-19db8407-1086-48a1-82e8-362083b47754   1Gi        RWO            standard       18m
persistentvolumeclaim/config-volume-web-app-statefulset-1   Bound    pvc-2d19f580-4421-4a96-b12f-d40094570168   1Gi        RWO            standard       18m
```

`minikube service app-python-chart`

```
|-----------|------------------|-------------|--------------|
| NAMESPACE |       NAME       | TARGET PORT |     URL      |
|-----------|------------------|-------------|--------------|
| default   | app-python-chart |             | No node port |
|-----------|------------------|-------------|--------------|
üòø  service default/app-python-chart has no node port
üèÉ  Starting tunnel for service app-python-chart.
|-----------|------------------|-------------|------------------------|
| NAMESPACE |       NAME       | TARGET PORT |          URL           |
|-----------|------------------|-------------|------------------------|
| default   | app-python-chart |             | http://127.0.0.1:60776 |
|-----------|------------------|-------------|------------------------|
üéâ  Opening service default/app-python-chart in default browser...
‚ùó  Because you are using a Docker driver on darwin, the terminal needs to be open to run it.
```

## Testing visits

Calling endpoint `/visits` on pod `web-app-statefulset-0`
`kubectl exec -it web-app-statefulset-0 -- bash`
Request: `curl localhost:8000/visits` Response: `1`
Request: `curl localhost:8000/visits` Response: `2`

Calling endpoint `/visits` on pod `web-app-statefulset-1`
`kubectl exec -it web-app-statefulset-1 -- bash`
Request: `curl localhost:8000/visits` Response: `1`
Request: `curl localhost:8000/visits` Response: `2`

#### Results explanation

The results are the same for different pods, which means that the state is not shared between pods. It happens because
the configMaps are different for each of the pods and they updating independently of each other.

#### Ordering guarantee

From the previous experiment we can see that the pods doesnt share their state, which means that they can start
independently in any order or in parallel.

## Parallel management

I added parallel pod starting policy and reinstalled the chart `get pods -w -l app=app-python`.

```
NAME                    READY   STATUS    RESTARTS   AGE
web-app-statefulset-0   0/1     Pending   0          0s
web-app-statefulset-0   0/1     Pending   0          0s
web-app-statefulset-1   0/1     Pending   0          0s
web-app-statefulset-1   0/1     Pending   0          0s
web-app-statefulset-0   0/1     ContainerCreating   0          0s
web-app-statefulset-1   0/1     ContainerCreating   0          0s
web-app-statefulset-0   1/1     Running             0          5s
web-app-statefulset-1   1/1     Running             0          6s
web-app-statefulset-0   1/1     Terminating         0          80s
web-app-statefulset-1   1/1     Terminating         0          80s
web-app-statefulset-0   0/1     Terminating         0          110s
web-app-statefulset-1   0/1     Terminating         0          110s
```

Here we can see that pods are starting and terminating independently.

## Update strategies

### RollingUpdate

RollingUpdate is the way of updating service without simultaneous downtime of all the pods. Rolling updates works by
updating some subset of instances, deploying them into the working condition and only then starts to update other ones.

### OnDelete

This is a more manual strategy when user has to delete old pods in order to create the new ones. The controller will
create new pods only if the old ones are manually deleted. 