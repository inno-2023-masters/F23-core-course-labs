# Task 1

## Components

* **Prometheus**: The back-end of the monitoring system, which stores and processes monitoring logs.

* **Prometheus Operator**: Simplifies the process of creation and managing of Prometheus deployments on kubernetes.

* **Gradana**: The front-end of the monitoring system, providing visualizations of the data.

* **Alertmanager**: Manages the collection and processing (grouping, filtering) of alerts coming from Prometheus, provides the ability to further transfer the alerts (to email etc.).

* **kube-state-metrics**: Kubernetes service that collects metrics of k8s objects using k8s API.

* **node-exporter**: Provides low-level metrics by monitoring the host system.

* **prometheus-adapter**: Provides additional resource metrics for Kubernetes.

## Installing the stack

Preparing minikube, disabling metrics server, starting with necessary configuration.
Installing the promotheus stack:

`helm repo add prometheus-community https://prometheus-community.github.io/helm-charts`\
`helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack`

After installing my apps chart, `kubectl get po,sts,svc,pvc,cm`:

```bash
NAME                                                            READY   STATUS    RESTARTS   AGE
pod/alertmanager-kube-prometheus-stack-alertmanager-0           2/2     Running   0          2m7s
pod/doe-app-0                                                   1/1     Running   0          65s
pod/doe-app-1                                                   1/1     Running   0          65s
pod/doe-app-2                                                   1/1     Running   0          65s
pod/kube-prometheus-stack-grafana-577898c78d-nh26h              3/3     Running   0          2m25s
pod/kube-prometheus-stack-kube-state-metrics-75bb879494-5nx5h   1/1     Running   0          2m25s
pod/kube-prometheus-stack-operator-58cc5bbb87-dvrw8             1/1     Running   0          2m25s
pod/kube-prometheus-stack-prometheus-node-exporter-ctspx        1/1     Running   0          2m25s
pod/prometheus-kube-prometheus-stack-prometheus-0               2/2     Running   0          2m7s

NAME                                                               READY   AGE
statefulset.apps/alertmanager-kube-prometheus-stack-alertmanager   1/1     2m7s
statefulset.apps/doe-app                                           3/3     65s
statefulset.apps/prometheus-kube-prometheus-stack-prometheus       1/1     2m7s

NAME                                                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                            ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   2m7s
service/doe-app                                          ClusterIP   10.103.202.208   <none>        8000/TCP                     65s
service/kube-prometheus-stack-alertmanager               ClusterIP   10.110.29.234    <none>        9093/TCP,8080/TCP            2m25s
service/kube-prometheus-stack-grafana                    ClusterIP   10.99.47.141     <none>        80/TCP                       2m25s
service/kube-prometheus-stack-kube-state-metrics         ClusterIP   10.103.163.169   <none>        8080/TCP                     2m25s
service/kube-prometheus-stack-operator                   ClusterIP   10.108.215.42    <none>        443/TCP                      2m25s
service/kube-prometheus-stack-prometheus                 ClusterIP   10.106.51.201    <none>        9090/TCP,8080/TCP            2m25s
service/kube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.103.164.1     <none>        9100/TCP                     2m25s
service/kubernetes                                       ClusterIP   10.96.0.1        <none>        443/TCP                      4m22s
service/prometheus-operated                              ClusterIP   None             <none>        9090/TCP                     2m7s

NAME                                            STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/config-volume-doe-app-0   Bound    pvc-d5c83d10-33af-4513-8371-415c2bdf9cb7   50Mi       RWO            standard       65s
persistentvolumeclaim/config-volume-doe-app-1   Bound    pvc-e5c0ad6a-30d9-4db0-97ee-1c97fab00387   50Mi       RWO            standard       65s
persistentvolumeclaim/config-volume-doe-app-2   Bound    pvc-g4a38fg2-3j8d-23td-3481-4vrh8rf983hc   50Mi       RWO            standard       65s

NAME                                                                DATA   AGE
configmap/config-doe                                                1      65s
configmap/kube-prometheus-stack-alertmanager-overview               1      2m25s
configmap/kube-prometheus-stack-apiserver                           1      2m25s
configmap/kube-prometheus-stack-cluster-total                       1      2m25s
configmap/kube-prometheus-stack-controller-manager                  1      2m25s
configmap/kube-prometheus-stack-etcd                                1      2m25s
configmap/kube-prometheus-stack-grafana                             1      2m25s
configmap/kube-prometheus-stack-grafana-config-dashboards           1      2m25s
configmap/kube-prometheus-stack-grafana-datasource                  1      2m25s
configmap/kube-prometheus-stack-grafana-overview                    1      2m25s
configmap/kube-prometheus-stack-k8s-coredns                         1      2m25s
configmap/kube-prometheus-stack-k8s-resources-cluster               1      2m25s
configmap/kube-prometheus-stack-k8s-resources-multicluster          1      2m25s
configmap/kube-prometheus-stack-k8s-resources-namespace             1      2m25s
configmap/kube-prometheus-stack-k8s-resources-node                  1      2m25s
configmap/kube-prometheus-stack-k8s-resources-pod                   1      2m25s
configmap/kube-prometheus-stack-k8s-resources-workload              1      2m25s
configmap/kube-prometheus-stack-k8s-resources-workloads-namespace   1      2m25s
configmap/kube-prometheus-stack-kubelet                             1      2m25s
configmap/kube-prometheus-stack-namespace-by-pod                    1      2m25s
configmap/kube-prometheus-stack-namespace-by-workload               1      2m25s
configmap/kube-prometheus-stack-node-cluster-rsrc-use               1      2m25s
configmap/kube-prometheus-stack-node-rsrc-use                       1      2m25s
configmap/kube-prometheus-stack-nodes                               1      2m25s
configmap/kube-prometheus-stack-nodes-darwin                        1      2m25s
configmap/kube-prometheus-stack-persistentvolumesusage              1      2m25s
configmap/kube-prometheus-stack-pod-total                           1      2m25s
configmap/kube-prometheus-stack-prometheus                          1      2m25s
configmap/kube-prometheus-stack-proxy                               1      2m25s
configmap/kube-prometheus-stack-scheduler                           1      2m25s
configmap/kube-prometheus-stack-workload-total                      1      2m25s
configmap/kube-root-ca.crt                                          1      4m8s
configmap/prometheus-kube-prometheus-stack-prometheus-rulefiles-0   34     2m7s
```

Explanation:

* Pods: we can see the 3 replicas of my app and the Prometheus stack:
  alertmanager, grafana, state-metrics, exporter, operator and Prometheus.

* Statefulsets: there are stateful sets for Prometheus, Alertmanager and my app.

* Service: Shows IPs and opened ports of pods in the cluster.

* Volumes: Volumes for my app.

* comfigmap: various configmaps.

## Grafana

CPU & Memory usage:

![Alt text](images/grafana1.png)

Prometheus-monitoring has highest CPU usage. Alertmanager and the app have low CPU usage:

![Alt text](images/grafana2.png)

Memory usage:

![Alt text](images/grafana_memory.png)

Running pods:

![Alt text](images/grafana3.png)

Network usage is fairly low:

![Alt text](images/grafana-network.png)

There are 5 alerts in total:

![Alt text](images/alertmanager.png)
