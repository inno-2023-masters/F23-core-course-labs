# Task 1: Kubernetes Cluster Monitoring with Prometheus

## Components of the Kube Prometheus Stack
- Prometheus - Retrieve metric from endpoints
- Prometheus operator - simplifies and automates the setup of Prometheus
- Prometheus node-exporter - collects and sends hardware and OS metrics to Prometheus
- Alertmanager - Service to deliver alerts
- Node Exporter - grub system info and metrics
- kube-state-metrics - collector for metrics
- Graphana - GUI for dashboards

## Output of the `kubectl get po,sts,svc,pvc,cm`
```
NAME                                                         READY   STATUS             RESTARTS   AGE
pod/alertmanager-kube-prom-stack-kube-prome-alertmanager-0   2/2     Running            0          4m34s
pod/app-python-node-66c4798c8-8h4qz                          1/1     Running            0          5m34s
pod/kube-prom-stack-grafana-7f654cd9d5-fxl8f                 3/3     Running            0          5m17s
pod/kube-prom-stack-kube-prome-operator-789f477cd4-hb9q2     1/1     Running            0          5m17s
pod/kube-prom-stack-kube-state-metrics-77fdf8c689-np5b7      1/1     Running            0          5m17s
pod/kube-prom-stack-prometheus-node-exporter-bwj6p           1/1     Running            0          5m17s
pod/prometheus-kube-prom-stack-kube-prome-prometheus-0       2/2     Running            0          4m34s

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-kube-prom-stack-kube-prome-alertmanager   1/1     4m34s
statefulset.apps/prometheus-kube-prom-stack-kube-prome-prometheus       1/1     4m34s

NAME                                               TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE     
service/alertmanager-operated                      ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   4m34s   
service/app-python-node                            NodePort       10.106.236.58    <none>        8089:30992/TCP               5m34s     
service/kube-prom-stack-grafana                    ClusterIP      10.102.24.183    <none>        80/TCP                       5m17s
service/kube-prom-stack-kube-prome-alertmanager    ClusterIP      10.110.155.42    <none>        9093/TCP,8080/TCP            5m17s   
service/kube-prom-stack-kube-prome-operator        ClusterIP      10.110.73.97     <none>        443/TCP                      5m17s   
service/kube-prom-stack-kube-prome-prometheus      ClusterIP      10.103.238.151   <none>        9090/TCP,8080/TCP            5m17s   
service/kube-prom-stack-kube-state-metrics         ClusterIP      10.107.85.156    <none>        8080/TCP                     5m17s   
service/kube-prom-stack-prometheus-node-exporter   ClusterIP      10.101.86.79     <none>        9100/TCP                     5m17s   
service/kubernetes                                 ClusterIP      10.96.0.1        <none>        443/TCP                      28d     
service/prometheus-operated                        ClusterIP      None             <none>        9090/TCP                     4m34s   

NAME                                                                     DATA   AGE
configmap/kube-prom-stack-grafana                                        1      5m17s
configmap/kube-prom-stack-grafana-config-dashboards                      1      5m17s
configmap/kube-prom-stack-kube-prome-alertmanager-overview               1      5m17s
configmap/kube-prom-stack-kube-prome-apiserver                           1      5m17s
configmap/kube-prom-stack-kube-prome-cluster-total                       1      5m17s
configmap/kube-prom-stack-kube-prome-controller-manager                  1      5m17s
configmap/kube-prom-stack-kube-prome-etcd                                1      5m17s
configmap/kube-prom-stack-kube-prome-grafana-datasource                  1      5m17s
configmap/kube-prom-stack-kube-prome-grafana-overview                    1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-coredns                         1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-cluster               1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-multicluster          1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-namespace             1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-node                  1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-pod                   1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-workload              1      5m17s
configmap/kube-prom-stack-kube-prome-k8s-resources-workloads-namespace   1      5m17s
configmap/kube-prom-stack-kube-prome-kubelet                             1      5m17s
configmap/kube-prom-stack-kube-prome-namespace-by-pod                    1      5m17s
configmap/kube-prom-stack-kube-prome-namespace-by-workload               1      5m17s
configmap/kube-prom-stack-kube-prome-node-cluster-rsrc-use               1      5m17s
configmap/kube-prom-stack-kube-prome-node-rsrc-use                       1      5m17s
configmap/kube-prom-stack-kube-prome-nodes                               1      5m17s
configmap/kube-prom-stack-kube-prome-nodes-darwin                        1      5m17s
configmap/kube-prom-stack-kube-prome-persistentvolumesusage              1      5m17s
configmap/kube-prom-stack-kube-prome-pod-total                           1      5m17s
configmap/kube-prom-stack-kube-prome-prometheus                          1      5m17s
configmap/kube-prom-stack-kube-prome-proxy                               1      5m17s
configmap/kube-prom-stack-kube-prome-scheduler                           1      5m17s
configmap/kube-prom-stack-kube-prome-workload-total                      1      5m17s
configmap/kube-root-ca.crt                                               1      28d
configmap/prometheus-kube-prom-stack-kube-prome-prometheus-rulefiles-0   34     4m34s
```

## Explanation
Pods: 
- `pod/alertmanager-kube-prom-stack-kube-prome-alertmanager-0` - alert manager
- `pod/app-python-node-66c4798c8-8h4qz ` - python app node
- `pod/kube-prom-stack-grafana-7f654cd9d5-fxl8f` - grafana
- `pod/kube-prom-stack-kube-prome-operator-789f477cd4-hb9q2` - prometheus operator
- `pod/kube-prom-stack-kube-state-metrics-77fdf8c689-np5b7` - kube state metrics
- `pod/kube-prom-stack-prometheus-node-exporter-bwj6p` - node exporter
- `pod/prometheus-kube-prom-stack-kube-prome-prometheus-0` - prometheus

Stateful sets:
- `statefulset.apps/alertmanager-kube-prom-stack-kube-prome-alertmanager` - stateful set of alert manager
- `statefulset.apps/prometheus-kube-prom-stack-kube-prome-prometheus` - stateful set of prometheus

### python app cpu and memory usage
![Alt text](image.png)
![Alt text](image-1.png)

### node cpu and memory usage
![Alt text](image-2.png)
![Alt text](image-3.png)

# Task 2: Init Containers

`helm install python . --values values.python.yaml`

Output:
```
NAME: python
LAST DEPLOYED: Mon Dec 11 22:43:17 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w python-helm-app'
  export SERVICE_IP=$(kubectl get svc --namespace default python-helm-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8080
```

`kubectl logs app-python-node-66c4798c8-8h4qz -c install -f`

Output:
```
Connecting to info.cern.ch (187.183.101.180:80)
index.html           100% |*******************************|   545   0:00:00 ETA

Defaulted container "helm-app" out of: helm-app, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```