---
- name: Run application
  block:
    - name: check deps
      apt:
        name:
          - docker
        state: present
      tags:
        - check_deps

    - name: wipe
      include_tasks: 0-wipe.yml
      tags:
        - wipes
      when: web_app_full_wipe | default(false) | bool

    - name: start app
      docker_container:
        name: app
        image: "{{ image }}"
        ports:
          - "{{ ports }}"
        env: "{{ envs }}"
      tags:
        - run_docker

    - name: Create a directory if it does not exist
      ansible.builtin.file:
        path: "/temp/{{image}}"
        state: directory

    - name: employ template module
      template:
        src: docker-compose.yml.j2
        dest: "/temp/{{image}}/docker-compose.yml"
